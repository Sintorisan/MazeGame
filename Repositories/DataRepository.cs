using System.Text.Json;
using System.Text.Json.Serialization;
using System.Text.Json.Serialization.Metadata;
using MazeGame.Enums;
using MazeGame.Models;
using MazeGame.Models.Characters;
using MazeGame.Models.Items;

namespace MazeGame;

public class DataRepository
{
    private readonly Dictionary<Type, string> dataPaths;
    private readonly Random rnd = new Random();

    public DataRepository()
    {
        var projectPath = AppDomain.CurrentDomain.BaseDirectory;
        dataPaths = new Dictionary<Type, string>
        {
            {typeof(Monster), Path.Combine(projectPath, "Data", "monsters.json")},
            {typeof(Treasure), Path.Combine(projectPath, "Data", "treasures.json")},
            {typeof(Scenery), Path.Combine(projectPath, "Data", "sceneries.json")}
        };
    }


    public Monster GetMonster()
    {
        var monsters = FetchData<Monster>();

        return monsters[rnd.Next(monsters.Count())];
    }

    public View GetMonsterWallView()
    {
        var views = FetchData<View>()
            .Where(v => v.WallType == WallType.Monster)
            .ToList();

        return views[rnd.Next(views.Count())];
    }

    public Treasure GetTreasure()
    {
        var treasures = FetchData<Treasure>();

        return treasures[rnd.Next(treasures.Count())];
    }

    public View GetTreasureWallView()
    {
        var views = FetchData<View>()
            .Where(v => v.WallType == WallType.Treasure)
            .ToList();

        return views[rnd.Next(views.Count())];
    }

    public View GetDoorWallView()
    {
        var views = FetchData<View>()
            .Where(v => v.WallType == WallType.Door)
            .ToList();

        return views[rnd.Next(views.Count())];
    }

    public View GetEmptyWallView()
    {
        var views = FetchData<View>()
            .Where(v => v.WallType == WallType.Empty)
            .ToList();

        return views[rnd.Next(views.Count())];
    }

    public View GetRegularWallView()
    {
        var views = FetchData<View>()
            .Where(v => v.WallType == WallType.Empty
                || v.WallType == WallType.Door)
            .ToList();

        return views[rnd.Next(views.Count())];
    }

    public Scenery GetScenery(RoomType roomType)
    {
        var sceneries = FetchData<Scenery>()
            .Where(s => s.RoomType == roomType)
            .ToList();

        return sceneries[rnd.Next(sceneries.Count())];
    }

    private List<T> FetchData<T>()
    {
        if (typeof(T) == typeof(View))
        {
            return GetViews() as List<T>;
        }

        if (!dataPaths.TryGetValue(typeof(T), out var path) || !File.Exists(path))
        {
            return new();
        }

        var json = File.ReadAllText(path);

        var options = new JsonSerializerOptions
        {
            PropertyNameCaseInsensitive = true,
            Converters =
    {
        new JsonStringEnumConverter(JsonNamingPolicy.CamelCase)
    },
            TypeInfoResolverChain = { new DefaultJsonTypeInfoResolver() }
        };

        return JsonSerializer.Deserialize<List<T>>(json, options)!;
    }

    private List<View> GetViews()
    {
        return new List<View>
        {
             new View { WallType = WallType.Empty, Ascii = @"
\                                                                              /
 \____________________________________________________________________________/ 
  │   │;;  ░░  ░░▒░  º   ░ │░░░░ ; ░ │  ░  ▒ ░░░░  ░░░░;    `░  ; ░░░  ▒ `  ;│  
  │; ▒   ░▒░ `  ▒    ; ▒░░ │  ▒░▒    │; ░░▒░░  º;; ▒   ;▒ │  ░░░░░ ▒  *;░│ ▒ │  
  │   ┴ ─  ─ ┬   ── ─ ───  ┴┬  ─ ─── ┴ ── ── ─ ┬  ─ ───── ┴─── ─ ┬  ───  ┴ ─ │  
  │░░░░   ;; │  ░░░░*   ░░░    ;   ▒;  ░░░   ;   ░░ * ;; `    ░  │  ░░ ;;    │  
  │ ░░  ;  ░░│  ▒  ░   ░    │   ░░░░;    ░░    │  ▒  ; ░░  ; ░░     ▒`░ ; ░  │  
  │ ;▒ ░░░░  │ δ  ;  ▒░   ; │   ▒    ▒   ▒░  ░ │▒    ░░░▒▒▒  ░;  δ    ░      │  
  │  ▒░░      │ │ ;  ░░ ░░     `   ░░░    ;;    ░░░░░    ░░░░░  │ │; ░░░ ▒ ;;│  
  │  ──┬  ───┴│_│──  ┬  ── ─┴ ───────── ┬───   ┴──── ────┬  ─── │_│ ─  ─┬ ───│  
  │;  ░  ░ ░░ \ /  ░  ░    ▒;      ▒           º   ; ░    ░░░ ` \ /  ▒ `│ ░  │  
  │░░▒  º░ ░░  V  ░░ │░` ▒░ ;    ░ ;▒  *│ ▒ ░░░  ▒   ▒░  │  ░ ▒  V  ░░;;  ░; │  
  │`░  │ ░░▒░░░  ░▒░    ▒  ░░░░░▒  ;░░  │ ░ ░   ▒  ░░▒░░ │;   ;   ░░░    ▒░  │  
  │ ░░ │    ░░░  ▒ ░   ░░░░     ░       │ ░░░;  ;;   ░░ ` ;     ▒░░  `  │    │  
  │ ─  ┴  ┬ ───  ┬─  ┴ ──────     ┬ ──  ┴─  ┬─    ──── ─ ┴   ─ ┬──────  ┴  ─ │  
  │  ░  ░░ ░░  `    `     *   ░░  │      ▒   ;   ▒░░░░   ░░  ; │; ░░    ▒    │  
  │ ░░  ░ │;░  ;;    ;░▒░   ;░ `      ░░ ;  │   ░░░ ░░▒  ░░     ; ░░░  ░░░▒ ;│  
  │ ░ ░   │  ░░░░│  ░░░     ;░░▒  │ ▒;     `  ▒░   ░░  ░░░ ; ░ │   ▒░`    ░  │  
  │;░░░ ;    ░        ░░░░░     ░    ;; ░░░ │   ;;   ░░░     ▒        ;;  ░░ │  
  │  ───; ┴  ──┬─┴     ─   ┬ ───  ┴  ─  ┬  ─┴  ──── ┬  ─  ┬ ───┴  ────  ┬── `│  
  │ ; ░  ▒`      ░░   ▒ ; ░   ░░░░░░▒ ;  ▒ ░ ;  ;   │░░;▒    ▒  ░▒░ ;   ░░  ;│  
  │ ; ▒░░  ;;▒ │ ; ░░░░░ ` │ ░▒;  ;º ░  │ ░░░▒░  ; ▒ ░░░░░│░`  ░░░░▒;* ░│▒ ; │  
  │____________│___________│________________________│___________________│____│  
 /                                                                            \ 
/                                                                              \" },
             new View { WallType = WallType.Door, Ascii = @"
\                                                                              /
 \____________________________________________________________________________/ 
  │   │;;  ░░  ░░▒░  º   ░ │░░░░ ; ░ │  ░  ▒ ░░░░  ░░░░;    `░  ; ░░░  ▒ `  ;│  
  │; ▒   ░▒░    ▒    ; ▒░░ │  ▒░▒    │; ░░▒░░  º;; ▒   ;▒ │  ░░░░░ ▒  *;░│ ▒ │  
  │   ┴ ─  ─ ┬   ── ─ ───  ┴┬  ─ ─── ┴ ── ── ─ ┬  ─ ───── ┴─── ─ ┬  ───  ┴ ─ │  
  │░░░░   ;; │  ░░░░*   ░░░   ┌──╥────────╥─────╥──┐* ;; `    ░  │  ░░ ;;    │  
  │ ░░  ;  ░░│  ▒  ░   ░    │ │████████████████████╡ ; ░░  ; ░░     ▒`░ ; ░  │  
  │ ;▒ ░░░░  │ δ  ;  ▒░   ; │ │█████▓███▓█████▓████│ ░░░▒▒▒  ░;  δ    ░      │  
  │  ▒░░      │ │ ;  ░░ ░░    ╞█▓▓▓▓█▓▓▓▓▓█▓▓▓▓▓▓▓█│░    ░░░░░  │ │; ░░░ ▒ ;;│  
  │  ──┬  ───┴│_│──  ┬  ── ─┴ │█▓▓█▓▓▓▓▓▓▓▓▓▓▓█▓▓▓█╡ ────┬  ─── │_│ ─  ─┬ ───│  
  │;  ░  ░ ░░ \ /  ░  ░    ▒; ╞█▒▓▓▓▓▓█▓▓▒▓▓▓▓▓▓▒▓█│ ░    ░░░ ` \ /  ▒ `│ ░  │  
  │░░▒  º░ ░░  V  ░░ │░` ▒░ ; │█▒▓▒▒▓▒▒▒▒▓▒▒▒▒▒▓▒▒█│ ▒░  │  ░ ▒  V  ░░;;  ░; │  
  │`░  │ ░░▒░░░  ░▒░    ▒  ░░░│█▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒█│░▒░░ │;   ;   ░░░    ▒░  │  
  │ ░░ │    ░░░  ▒ ░   ░░░░   │█▒▒▒▒▓▒▒▓▒▒▒▒▒▒▒▓▓▒█│ ░░ ` ;     ▒░░  `  │    │  
  │ ─  ┴  ┬ ───  ┬─  ┴ ────── ╞█▓▒▒▒▒▒▒▒▒▒▓▒▒░▒▒▒▒█╡── ─ ┴   ─ ┬──────  ┴  ─ │  
  │  ░  ░░ ░░  `    `     *   │█▒▒▒▒▒░▒▒▒▒▒▒▒▒▒▒▒▒█│░░   ░░  ; │; ░░    ▒    │  
  │ ░░  ░ │;░  ;;    ;░▒░   ;░│█▒▒▒▒▒▒▒▒▒░▒▒▒▒▒▒▒░█│░░▒  ░░     ; ░░░  ░░░▒ ;│  
  │ ░ ░   │  ░░░░│  ░░░     ;░╞█▒░▒▒▒▒░▒▒▒▒▒▒▒░▒▒▒█╡░  ░░░ ; ░ │   ▒░`    ░  │  
  │;░░░ ;    ░        ░░░░░   │█▒░░░░░▒░░░░░░░░░▒░█│ ░░░     ▒        ;;  ░░ │  
  │  ───; ┴  ──┬─┴     ─   ┬ ─│█░░░▒░░░░░░▒░░▒░░░░█│┬  ─  ┬ ───┴  ────  ┬── `│  
  │ ; ░  ▒`      ░░   ▒ ; ░   │█░░░░▒░░░░░░░░░░░░░█╡│░░;▒    ▒  ░▒░ ;   ░░  ;│  
  │ ; ▒░░  ;;▒ │ ; ░░░░░ ` │ ░╞█░░░░░░░░░░░░░░░░░░█│ ░░░░░│░`  ░░░░▒;* ░│▒ ; │  
  │____________│___________│__│█░░░░░░░░░░░░░░░░░░█╡│___________________│____│  
 /                             / ░   ░          ░ \                           \ 
/                                                                              \" },
             new View { WallType = WallType.Door, Ascii = @"
\                                                                              /
 \____________________________________________________________________________/ 
  │   │;;  ░░  ░░▒░  º   ░ │░░░░ ; ░ │  ░  ▒ ░░░░  ░░░░;    `░  ; ░░░  ▒ `  ;│  
  │; ▒   ░▒░    ▒    ; ▒░░ │  ▒░▒    │; ░░▒░░  º;; ▒   ;▒ │  ░░░░░ ▒  *;░│ ▒ │  
  │   ┴ ─  ─ ┬   ── ─ ───  ┴┬  ─ ─── ┴ ── ── ─ ┬  ─ ───── ┴─── ─ ┬  ───  ┴ ─ │  
  │░░░░   ;; │  ░░░░*   ░░░   ┌──╥────────╥─────╥──┐* ;; `    ░  │  ░░ ;;    │  
  │ ░░  ;  ░░│  ▒  ░   ░    │ │████████████████████╡ ; ░░  ; ░░     ▒`░ ; ░  │  
  │ ;▒ ░░░░  │    ;  ▒░   ; │ │█████▓███▓█████▓████│ ░░░▒▒▒  ░;  │    ░      │  
  │  ▒░░       ░  ;  ░░ ░░    ╞█▓▓▓▓█▓▓▓▓▓█▓▓▓▓▓▓▓█│░    ░░░░░     ; ░░░ ▒ ;;│  
  │  ──┬  ───┴   ──  ┬  ── ─┴ │█▓▓█▓▓▓▓▓▓▓▓▓▓▓█▓▓▓█╡ ────┬  ───  ┴  ─  ─┬ ───│  
  │;  ░  ░ ░░      ░  ░    ▒; ╞█▒▓▓▓▓▓█▓▓▒▓▓▓▓▓▓▒▓█│ ░    ░░░ `  ░   ▒ `│ ░  │  
  │░░▒  º░ ░░   ░ ░░ │░` ▒░ ; │█▒▓▒▒▓▒▒▒▒▓▒▒▒▒▒▓▒▒█│ ▒░  │  ░ ▒     ░░;;  ░; │  
  │`░  │ ░░▒░░░  ░▒░    ▒  ░░░│█▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒█│░▒░░ │;   ;   ░░░    ▒░  │  
  │ ░░ │    ░░░  ▒ ░   ░░░░   │█▒▒▒▒▓▒▒▓▒▒▒▒▒▒▒▓▓▒█│ ░░ ` ;     ▒░░  `  │    │  
  │ ─  ┴  ┬ ───  ┬─  ┴ ────── ╞█▓▒▒▒▒▒▒▒▒▒▓▒▒░▒▒▒▒█╡── ─ ┴   δ ┬──────  ┴  ─ │  
  │  ░  ░░ ░░  `    `     *   │█▒▒▒▒▒░▒▒▒▒▒▒▒▒▒▒▒▒█│░░   ░░ |""|│; ░░  __     │  
  │ ░░  ░ │;░  ; ; ;░▒░     ;░│█▒▒▒▒▒▒▒▒▒░▒▒▒▒▒▒▒░█│░░▒  ░░ | | ; ░░░ || ░▒ ;│  
  │ ░ ░   │  ░░░░│  ░░░     ;░╞█▒░▒▒▒▒░▒▒▒▒▒▒▒░▒▒▒█╡░  ░░░\▀|_|▀▀▀▀▀▀(__)\░  │  
  │;░░░ ;    ░        ░░░░░   │█▒░░░░░▒░░░░░░░░░▒░█│ ░░░  ▌▌▀▀▀▀▀▀▀▀▀▀▀▀▀▐░░ │  
  │  ───; ┴  ──┬─┴     ─   ┬ ─│█░░░▒░░░░░░▒░░▒░░░░█│┬  ─  ▌▌╔═══════════╗▐─ `│  
  │ ; ░  ▒`      ░░   ▒ ; ░   │█░░░░▒░░░░░░░░░░░░░█╡│░░;▒ ▌▌║     Θ     ║▐  ;│  
  │ ; ▒░░  ;;▒ │ ; ░░░░░ ` │ ░╞█░░░░░░░░░░░░░░░░░░█│ ░░░░░▌▌╠═══════════╣▐ ; │  
  │____________│___________│__│█░░░░░░░░░░░░░░░░░░█╡│_____▌▌║     Θ     ║▐___│  
 /                             / ░   ░          ░ \      ░\▌╚═══════════╝▐    \ 
/                                                         ░░░░░░░░░░░░░░░░     \" },
             new View { WallType = WallType.Treasure, Ascii= @"
\                                                                              /
 \____________________________________________________________________________/ 
  │   │;;  ░░  ░░▒░  º   ░ │░░░░ ; ░ │  ░  ▒ ░░░░  ░░░░;    `░  ; ░░░  ▒ `  ;│  
  │; ▒   ░▒░    ▒    ; ▒░░ │  ▒░▒    │; ░░▒░░  º;; ▒   ;▒ │  ░░░░░ ▒  *;░│ ▒ │  
  │   ┴ ─  ─ ┬   ── ─ ───  ┴┬  ─ ─── ┴ ── ── ─ ┬  ─ ───── ┴─── ─ ┬  ───  ┴ ─ │  
  │░░░░   ;; │  ░░░░*   ░░░    ;   ▒;  ░░░   ;   ░░ * ;; `    ░  │  ░░ ;;    │  
  │ ░░  ;  ░░│  ▒  ░   ░    │   ░░░░;    ░░    │  ▒  ; ░░  ; ░░     ▒`░ ; ░  │  
  │ ;▒ ░░░░  │ δ  ;  ▒░   ; │   ▒    ▒   ▒░  ░ │▒    ░░░▒▒▒  ░;  δ    ░      │  
  │  ▒░░      │ │ ;  ░░ ░░     `   ░░░    ;;    ░░░░░    ░░░░░  │ │; ░░░ ▒ ;;│  
  │  ──┬  ───┴│_│──  ┬  ── ─┴ ───────── ┬───   ┴──── ────┬  ─── │_│ ─  ─┬ ───│  
  │;  ░  ░ ░░ \ /  ░  ░    ▒;      ▒           º   ; ░    ░░░ ` \ /  ▒ `│ ░  │  
  │░░▒  º░ ░░  V  ░░ │░` ▒░ ;    ░ ;▒  *│ ▒ ░░░  ▒   ▒░  │  ░ ▒  V  ░░;;  ░; │  
  │`░  │ ░░▒░░░  ░▒░    ▒  ░░░░░▒  ;░░  │ ░ ░   ▒  ░░▒░░ │;   ;   ░░░    ▒░  │  
  │ ░░ │    ░░░  ▒ ░   ░░░░     ░       │ ░░░;  ;;   ░░ ` ;     ▒░░  `  │    │  
  │ ─  ┴  ┬ ───  ┬─  ┴ ──────     ┬ ──  ┴─  ┬─    ──── ─ ┴   ─ ┬──────  ┴  ─ │  
  │  ░  ░░ ░░  `    `     *   .∙--------------.  ▒░░░░   ░░  ; │; ░░    ▒    │  
  │ ░░  ░ │;░  ;;    ;░▒░   ;░\\`______________`.░░ ░░▒  ░░     ; ░░░  ░░░▒ ;│  
  │ ░ ░   │  ░░░░│  ░░░     ;░\\|_______________|  ░░  ░░░ ; ░ │   ▒░`    ░  │  
  │;░░░ ;    ░        ░░░░░  ░\\| ~`  ~ Φ    ~~ |;   ░░░     ▒        ;;  ░░ │  
  │  ───; ┴  ──┬─┴     ─   ┬\`\\|  ~ ~  ` ~  `~ |── ┬  ─  ┬ ───┴  ────  ┬── `│  
  │ ; ░  ▒`      ░░   ▒ ; ░ |\_\|_______________|\  │░░;▒    ▒  ░▒░ ;   ░░  ;│  
  │ ; ▒░░  ;;▒ │ ; ░░░░░ ` │|(____________________)▒ ░░░░░│░`  ░░░░▒;* ░│▒ ; │  
  │____________│___________│|\░░░▒░░░░░▒░░░░░░░░░░|_│___________________│____│  
 /                           \░░░░░░░░░░░░░░░░▒░░░|                           \ 
/                            (░▒░░░░░░░▒░░░░░░░░░░)                            \" },
             new View { WallType = WallType.Monster, Ascii= @"
\                                                                              /
 \____________________________________________________________________________/ 
  │   │;;  ░░  ░░▒░  º   ░ │░░░░ ; ░ │  ░  ▒ ░░░░  ░░░░;    `░  ; ░░░  ▒    ;│  
  │; ▒   ░▒░    ▒    ; ▒░░ │  ▒░▒    │; ░░▒░░  º;; ▒   ;▒ │  ░░░░░ ▒  *;░│ ▒ │  
  │   ┴ ─  ─ ┬   ── ─ ───  ┴┬  ─ ─── ┴ ── ── ─ ┬  ─ ───── ┴─── ─ ┬  ───  ┴ ─ │  
  │░░░░   ;; │  ░░░░*   ░░░    ;   ▒;  ░░░   ;   ░░ * ;; `    ░  │  ░░ ;;    │  
  │ ░░  ;  ░░│  ▒  ░   ░    │   ░░░░;    ░░    │  ▒  ; ░░  ; ░░     ▒`░ ; ░  │  
  │ ;▒ ░░░░  │ δ  ;  ▒░   ; │   ▒    ▒   ▒░  ░ │▒    ░░░▒▒▒  ░;  δ    ░      │  
  │  ▒░░      │ │ ;  ░░ ░░     `   ░░░    ;;    ░░░░░    ░░░░░  │ │; ░░░ ▒ ;;│  
  │  ──┬  ───┴│_│──  ┬  ── ─┴ ───────── ┬───   ┴──── ────┬  ─── │_│ ─  ─┬ ───│  
  │;  ░  ░ ░░ \ /  ░  ░    ▒;    ░   ▒/\_/\    º   ; ░    ░░░ ` \ /  ▒ `│ ░  │  
  │░░▒  º░ ░░  V  ░░ │░` ▒░ ;    ░░ _( o o )_░░  ▒   ▒░  │  ░ ▒  V  ░░;;  ░; │  
  │`░  │ ░░▒░░░  ░▒░    ▒  ░░░░░▒  /  \_-_/  \  ▒  ░░▒░░ │;   ;   ░░░    ▒░  │  
  │ ░░ │    ░░░  ▒ ░   ░░░░     ░ /    ___    \ ;;   ░░ ` ;     ▒░░  `  │    │  
  │ ─  ┴  ┬ ───  ┬─  ┴ ──────  ──|   _/   \_   |─ ──── ─ ┴   ─ ┬──────  ┴  ─ │  
  │  ░  ░░ ░░  `    `     *   ░░ |  /   _   \  | ▒░░░░   ░░  ; │; ░░    ▒    │  
  │ ░░  ░ │;░  ;;    ;░▒░   ;░ ` | |   (_)   | |░░░ ░░▒  ░░     ; ░░░  ░░░▒ ;│  
  │ ░ ░   │  ░░░░│  ░░░     ;░░▒ |  \       /  |   ░░  ░░░ ; ░ │   ▒░`    ░  │  
  │;░░░ ;    ░        ░░░░░     ░ \  \__^__/  / ;;   ░░░     ▒        ;;  ░░ │  
  │  ───; ┴  ──┬─┴     ─   ┬ ───  ─\_       _/ ──── ┬  ─  ┬ ───┴  ────  ┬── `│  
  │ ; ░  ▒`      ░░   ▒ ; ░   ░░░   /|     |\;  ;   │░░;▒    ▒  ░▒░ ;   ░░  ;│  
  │ ; ▒░░  ;;▒ │ ; ░░░░░ ` │ ░▒;   /_|     |_\░  ; ▒ ░░░░░│░`  ░░░░▒;* ░│▒ ; │  
  │____________│___________│_______ /       \ ______│___________________│____│  
 /                                 (___/ \___)                                \ 
/                                                                              \" },
        };
    }

}
